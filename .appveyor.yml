version: "{build}"

environment:
  global:
    # Only need one flavour of dictionary
    CONFIGURE_FLAGS: --with-hunspell-dir=/mingw64/share/hunspell
    VERBOSE: 1 # Get test logs in output
  matrix:
    # MSYS does not have hunspell packages
    # - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
    #   MSYSTEM: MSYS
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
      MSYSTEM: MINGW64
    - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
      MSYSTEM: MINGW32

for:
-
  matrix:
    only:
      - APPVEYOR_BUILD_WORKER_IMAGE: Visual Studio 2019
  init:
    - git config --global core.autocrlf input
    - C:\msys64\usr\bin\bash.exe -lc "pacman --noconfirm -S libtool autoconf automake"
  install:
    - C:\msys64\usr\bin\bash.exe -l c:/projects/enchant/build-aux/appveyor-install.sh
  # FIXME: add all available providers (just aspell?)
  build_script:
    - C:\msys64\usr\bin\bash.exe -lc "cd c:/projects/enchant && ./bootstrap && ./configure --enable-relocatable %CONFIGURE_FLAGS% && make && make DISTCHECK_CONFIGURE_FLAGS=\"--enable-relocatable %CONFIGURE_FLAGS%\" distcheck"
